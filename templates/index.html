<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Dashboard - Datadog & GitHub</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .metric-card {
            transition: transform 0.2s;
        }
        .metric-card:hover {
            transform: translateY(-5px);
        }
        .chart-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        .navbar-brand {
            font-weight: bold;
        }
        .sidebar {
            background: #f8f9fa;
            min-height: 100vh;
            padding: 20px;
        }
        .main-content {
            padding: 20px;
        }
        .metric-selector {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .client-token-info {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        .github-info {
            background: #f3e5f5;
            border-left: 4px solid #9c27b0;
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        .azuredevops-info {
            background: #e3f2fd;
            border-left: 4px solid #0078d4;
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        .figma-info {
            background: #f3e5f5;
            border-left: 4px solid #f24e1e;
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        .nav-tabs .nav-link {
            color: #495057;
        }
        .nav-tabs .nav-link.active {
            color: #0d6efd;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark bg-primary">
        <div class="container-fluid">
            <span class="navbar-brand">
                <i class="fas fa-chart-line"></i> Analytics Dashboard
            </span>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text">
                    <i class="fas fa-key"></i> Multi-Platform Analytics
                </span>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 sidebar">
                <!-- Datadog Configuration -->
                <div id="datadog-sidebar">
                    <h5><i class="fas fa-chart-line"></i> Datadog Configuration</h5>
                    
                    <div class="client-token-info">
                        <small><strong>Authentication:</strong> Application Key</small><br>
                        <small><strong>Site:</strong> {{ site }}</small><br>
                        <small><strong>API Key:</strong> {{ api_key[:8] }}...</small>
                    </div>
                    
                    <div class="metric-selector">
                        <h6>Select Metrics</h6>
                        <small class="text-muted mb-2 d-block">Choose one or more metrics to analyze:</small>
                        <div id="metrics-list">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="system.cpu.user" id="cpu">
                                <label class="form-check-label" for="cpu">
                                    CPU Usage
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="system.mem.used" id="memory">
                                <label class="form-check-label" for="memory">
                                    Memory Usage
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="system.disk.used" id="disk">
                                <label class="form-check-label" for="disk">
                                    Disk Usage
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="system.load.1" id="load">
                                <label class="form-check-label" for="load">
                                    System Load
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="aws.ec2.cpuutilization" id="ec2-cpu">
                                <label class="form-check-label" for="ec2-cpu">
                                    AWS EC2 CPU
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="docker.cpu.usage" id="docker-cpu">
                                <label class="form-check-label" for="docker-cpu">
                                    Docker CPU
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="metric-selector">
                        <h6>Time Range</h6>
                        <select class="form-select" id="time-range">
                            <option value="1">Last 1 hour</option>
                            <option value="6">Last 6 hours</option>
                            <option value="24" selected>Last 24 hours</option>
                            <option value="168">Last 7 days</option>
                        </select>
                    </div>

                    <div class="metric-selector">
                        <h6>Chart Type</h6>
                        <select class="form-select" id="chart-type">
                            <option value="line" selected>Line Chart</option>
                            <option value="bar">Bar Chart</option>
                        </select>
                    </div>

                    <div class="metric-selector">
                        <h6>Custom Metric</h6>
                        <input type="text" class="form-control mb-2" id="custom-metric" placeholder="Enter metric name">
                        <button class="btn btn-outline-primary btn-sm" onclick="addCustomMetric()">
                            <i class="fas fa-plus"></i> Add Metric
                        </button>
                    </div>

                    <button class="btn btn-primary w-100" onclick="updateDashboard()">
                        <i class="fas fa-sync"></i> Update Dashboard
                    </button>
                </div>

                <!-- GitHub Configuration -->
                <div id="github-sidebar" style="display: none;">
                    <h5><i class="fab fa-github"></i> GitHub Configuration</h5>
                    
                    <div class="github-info">
                        <small><strong>GitHub Integration:</strong> Multi-Repository Analytics</small><br>
                        <small><strong>Active Repos:</strong> <span id="github-repo-info">None configured</span></small>
                    </div>

                    <div class="metric-selector">
                        <h6><i class="fab fa-github"></i> Add Repository</h6>
                        <div class="row">
                            <div class="col-12">
                                <label for="github-repo-input" class="form-label">Repository (owner/repo format):</label>
                                <input type="text" class="form-control mb-2" id="github-repo-input" 
                                       placeholder="e.g., microsoft/vscode or tr/cs-prof-cloud_ultratax-api-services"
                                       onkeypress="if(event.key === 'Enter') addGitHubRepo()">
                            </div>
                            <div class="col-12">
                                <button class="btn btn-outline-success w-100 mb-2" onclick="addGitHubRepo()">
                                    <i class="fas fa-plus"></i> Add Repository
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="metric-selector">
                        <h6><i class="fas fa-sync-alt"></i> Azure DevOps Integration</h6>
                        <button class="btn btn-outline-info w-100 mb-2" onclick="syncRepositoriesFromAzureDevOps()">
                            <i class="fab fa-microsoft"></i> <i class="fas fa-arrow-right"></i> <i class="fab fa-github"></i> 
                            Sync from Azure DevOps
                        </button>
                        <small class="text-muted">Load repositories from Azure DevOps work items</small>
                    </div>

                    <div class="metric-selector">
                        <h6><i class="fas fa-list"></i> Selected Repositories</h6>
                        <div id="selected-repos" class="mb-2">
                            <small class="text-muted">No repositories selected</small>
                        </div>
                        <button class="btn btn-outline-danger btn-sm w-100" onclick="clearAllRepos()">
                            <i class="fas fa-trash"></i> Clear All
                        </button>
                    </div>

                    <div class="metric-selector">
                        <h6>Time Range</h6>
                        <select class="form-select" id="github-time-range">
                            <option value="7">Last 7 days</option>
                            <option value="30" selected>Last 30 days</option>
                            <option value="90">Last 90 days</option>
                        </select>
                    </div>

                    <div class="metric-selector">
                        <h6>Chart Type</h6>
                        <select class="form-select" id="github-chart-type">
                            <option value="overview" selected>PR Status Overview</option>
                            <option value="prs_by_day">PRs by Day</option>
                            <option value="prs_by_author">PRs by Author</option>
                            <option value="summary">Repository Summary Table</option>
                        </select>
                    </div>

                    <button class="btn btn-primary w-100" onclick="updateGitHubDashboard()">
                        <i class="fas fa-sync"></i> Update GitHub Analytics
                    </button>
                </div>

                <!-- Azure DevOps Configuration -->
                <div id="azuredevops-sidebar" style="display: block;">  <!-- Show by default since Azure DevOps is active tab -->
                    <h5><i class="fab fa-microsoft"></i> Azure DevOps Project Setup</h5>
                    
                    <div class="azuredevops-info">
                        <small><strong>Azure DevOps Integration:</strong> Work Items, Pull Requests & Builds</small><br>
                        <small><strong>Project:</strong> <span id="azuredevops-project-info">Not configured</span></small><br>
                        <small><strong>Area Path:</strong> <span id="azuredevops-area-info">Not specified</span></small>
                    </div>

                    <div class="metric-selector">
                        <h6><i class="fab fa-microsoft"></i> Project Setup</h6>
                        <div class="row">
                            <div class="col-12">
                                <label for="azuredevops-org" class="form-label">Organization Name:</label>
                                <input type="text" class="form-control mb-2" id="azuredevops-org" placeholder="e.g., mycompany">
                            </div>
                            <div class="col-12">
                                <label for="azuredevops-project" class="form-label">Project Name:</label>
                                <input type="text" class="form-control mb-2" id="azuredevops-project" placeholder="e.g., MyProject">
                            </div>
                            <div class="col-12">
                                <label for="azuredevops-area-path" class="form-label">Area Path (Optional):</label>
                                <input type="text" class="form-control mb-2" id="azuredevops-area-path" placeholder="e.g., MyProject\\Team\\Frontend">
                                <small class="form-text text-muted">Leave empty to use project root area</small>
                            </div>
                            <div class="col-12">
                                <button class="btn btn-outline-primary w-100" onclick="configureAzureDevOps()">
                                    <i class="fas fa-cog"></i> Configure
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="metric-selector">
                        <h6>Time Range</h6>
                        <select class="form-select" id="azuredevops-time-range">
                            <option value="7">Last 7 days</option>
                            <option value="30" selected>Last 30 days</option>
                            <option value="90">Last 90 days</option>
                        </select>
                    </div>
                    
                    <div class="metric-selector mt-3">
                        <h6>Analysis Mode</h6>
                        <select class="form-select" id="azuredevops-analysis-mode">
                            <option value="fast" selected>🚀 Fast Mode (1-2 seconds)</option>
                            <option value="detailed">🔍 Detailed Mode (includes PR/commit analysis)</option>
                        </select>
                        <small class="text-muted">Fast mode loads work items only. Detailed mode includes PR relations (~1 min).</small>
                    </div>
                    
                    <div class="metric-selector mt-3">
                        <h6>Chart Type</h6>
                        <select class="form-select" id="azuredevops-chart-type">
                            <option value="overview" selected>📊 Activity Overview</option>
                            <option value="work_items_by_type">🏷️ Work Items by Type</option>
                            <option value="work_items_by_state">📋 Work Items by State</option>
                            <option value="work_items_by_assignee">👤 Work Items by Assignee</option>
                            <option value="prs_by_status">🔀 Pull Requests by Status</option>
                            <option value="repositories_breakdown">📁 Repository Breakdown</option>
                        </select>
                        <small class="text-muted">Choose visualization type for your Azure DevOps data</small>
                    </div>

                    <button class="btn btn-primary w-100" onclick="updateAzureDevOpsDashboard()">
                        <i class="fas fa-sync"></i> Update Azure DevOps Analytics
                    </button>
                </div>

                <!-- Figma Configuration -->
                <div id="figma-sidebar" style="display: none;">
                    <h5><i class="fab fa-figma"></i> Figma Configuration</h5>
                    
                    <div class="figma-info">
                        <small><strong>Figma Integration:</strong> Design Files, Projects & Collaboration</small><br>
                        <small><strong>Team:</strong> <span id="figma-team-info">Not configured</span></small>
                    </div>

                    <div class="metric-selector">
                        <h6><i class="fab fa-figma"></i> Team Setup</h6>
                        <div class="row">
                            <div class="col-12">
                                <input type="text" class="form-control mb-2" id="figma-team-id" placeholder="Team ID">
                            </div>
                            <div class="col-12">
                                <button class="btn btn-outline-primary w-100" onclick="configureFigma()">
                                    <i class="fas fa-cog"></i> Configure
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="metric-selector">
                        <h6>Time Range</h6>
                        <select class="form-select" id="figma-time-range">
                            <option value="7">Last 7 days</option>
                            <option value="30" selected>Last 30 days</option>
                            <option value="90">Last 90 days</option>
                        </select>
                    </div>

                    <div class="metric-selector">
                        <h6>Chart Type</h6>
                        <select class="form-select" id="figma-chart-type">
                            <option value="files_by_project" selected>Files by Project</option>
                            <option value="collaboration_activity">Collaboration Activity</option>
                            <option value="project_overview">Project Overview</option>
                        </select>
                    </div>

                    <div class="metric-selector">
                        <h6>Search Files</h6>
                        <input type="text" class="form-control mb-2" id="figma-search" placeholder="Search file names">
                        <button class="btn btn-outline-secondary w-100" onclick="searchFigmaFiles()">
                            <i class="fas fa-search"></i> Search
                        </button>
                    </div>

                    <button class="btn btn-primary w-100" onclick="updateFigmaDashboard()">
                        <i class="fas fa-sync"></i> Update Figma Analytics
                    </button>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-md-9 main-content">
                <div class="row mb-4">
                    <div class="col-12">
                        <h2><i class="fas fa-tachometer-alt"></i> Analytics Overview</h2>
                        <p class="text-muted">Datadog Metrics (Application Key), GitHub Pull Requests, Azure DevOps & Figma Analytics</p>
                    </div>
                </div>

                <!-- Navigation Tabs -->
                <ul class="nav nav-tabs mb-4" id="analyticsTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="azuredevops-tab" data-bs-toggle="tab" data-bs-target="#azuredevops-pane" type="button" role="tab">
                            <i class="fab fa-microsoft"></i> Azure DevOps
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="github-tab" data-bs-toggle="tab" data-bs-target="#github-pane" type="button" role="tab">
                            <i class="fab fa-github"></i> GitHub Pull Requests
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="datadog-dashboards-tab" data-bs-toggle="tab" data-bs-target="#datadog-dashboards-pane" type="button" role="tab">
                            <i class="fas fa-tachometer-alt"></i> Datadog Dashboards
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="datadog-tab" data-bs-toggle="tab" data-bs-target="#datadog-pane" type="button" role="tab">
                            <i class="fas fa-chart-line"></i> Datadog Metrics
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="datadog-logs-tab" data-bs-toggle="tab" data-bs-target="#datadog-logs-pane" type="button" role="tab">
                            <i class="fas fa-file-alt"></i> Datadog Logs
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="figma-tab" data-bs-toggle="tab" data-bs-target="#figma-pane" type="button" role="tab">
                            <i class="fab fa-figma"></i> Figma
                        </button>
                    </li>
                </ul>

                <!-- Tab Content -->
                <div class="tab-content" id="analyticsTabContent">
                    <!-- Datadog Tab -->
                    <div class="tab-pane fade" id="datadog-pane" role="tabpanel">

                <!-- Metrics Summary Cards -->
                <div class="row mb-4" id="metrics-summary">
                    <!-- Dynamic content will be loaded here -->
                </div>

                <!-- Charts Section -->
                <div class="row">
                    <div class="col-12">
                        <h4><i class="fas fa-chart-area"></i> Metrics Visualization</h4>
                    </div>
                </div>

                <div id="charts-container">
                    <!-- Dynamic charts will be loaded here -->
                </div>
                    </div>

                    <!-- Datadog Logs Tab -->
                    <div class="tab-pane fade" id="datadog-logs-pane" role="tabpanel">
                        <!-- Logs Summary Cards -->
                        <div class="row mb-4" id="logs-summary">
                            <!-- Dynamic content will be loaded here -->
                        </div>

                        <!-- Logs Search and Filters -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h5><i class="fas fa-search"></i> Logs Search & Filters</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-3">
                                                <label for="logs-time-range" class="form-label">Time Range</label>
                                                <select class="form-select" id="logs-time-range">
                                                    <option value="1">Last 1 Hour</option>
                                                    <option value="6">Last 6 Hours</option>
                                                    <option value="24" selected>Last 24 Hours</option>
                                                    <option value="168">Last 7 Days</option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label for="logs-service-filter" class="form-label">Service</label>
                                                <select class="form-select" id="logs-service-filter">
                                                    <option value="">All Services</option>
                                                    <!-- Dynamic services will be loaded here -->
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label for="logs-level-filter" class="form-label">Log Level</label>
                                                <select class="form-select" id="logs-level-filter">
                                                    <option value="">All Levels</option>
                                                    <option value="error">Error</option>
                                                    <option value="warning">Warning</option>
                                                    <option value="info">Info</option>
                                                    <option value="debug">Debug</option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label for="logs-search-query" class="form-label">Search Query</label>
                                                <input type="text" class="form-control" id="logs-search-query" placeholder="Enter search terms...">
                                            </div>
                                        </div>
                                        <div class="row mt-3">
                                            <div class="col-12">
                                                <button class="btn btn-primary" onclick="searchLogs()">
                                                    <i class="fas fa-search"></i> Search Logs
                                                </button>
                                                <button class="btn btn-secondary" onclick="refreshLogsSummary()">
                                                    <i class="fas fa-sync"></i> Refresh Summary
                                                </button>
                                                <button class="btn btn-info" onclick="loadAllLogs()">
                                                    <i class="fas fa-list"></i> Load All Logs
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Logs List -->
                        <div class="row">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h5><i class="fas fa-list"></i> Recent Logs</h5>
                                    </div>
                                    <div class="card-body">
                                        <div id="logs-list">
                                            <!-- Dynamic logs will be loaded here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Datadog Dashboards Tab -->
                    <div class="tab-pane fade" id="datadog-dashboards-pane" role="tabpanel">
                        <!-- Dashboard Summary Cards -->
                        <div class="row mb-4" id="dashboards-summary">
                            <!-- Dynamic content will be loaded here -->
                        </div>

                        <!-- Dashboard Actions -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h5><i class="fas fa-cog"></i> Dashboard Management</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <button class="btn btn-primary" onclick="loadAllDashboards()">
                                                    <i class="fas fa-sync"></i> Refresh Dashboards
                                                </button>
                                                <button class="btn btn-info" onclick="loadDashboardDetails()">
                                                    <i class="fas fa-info-circle"></i> Load Dashboard Details
                                                </button>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="input-group">
                                                    <input type="text" class="form-control" id="dashboard-id-input" placeholder="Enter Dashboard ID">
                                                    <button class="btn btn-outline-secondary" onclick="loadSpecificDashboard()">
                                                        <i class="fas fa-search"></i> Load Dashboard
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Dashboard List -->
                        <div class="row">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h5><i class="fas fa-list"></i> Available Dashboards</h5>
                                    </div>
                                    <div class="card-body">
                                        <div id="dashboards-list">
                                            <!-- Dynamic dashboards will be loaded here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Dashboard Details -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h5><i class="fas fa-info-circle"></i> Dashboard Details</h5>
                                    </div>
                                    <div class="card-body">
                                        <div id="dashboard-details">
                                            <!-- Dynamic dashboard details will be loaded here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- GitHub Tab -->
                    <div class="tab-pane fade" id="github-pane" role="tabpanel">

                        <!-- GitHub Analytics Summary -->
                        <div class="row mb-4" id="github-summary">
                            <!-- Dynamic content will be loaded here -->
                        </div>

                        <!-- GitHub Charts -->
                        <div class="row">
                            <div class="col-12">
                                <h4><i class="fas fa-chart-area"></i> GitHub Pull Request Analytics</h4>
                            </div>
                        </div>

                        <div id="github-charts-container">
                            <!-- Dynamic charts will be loaded here -->
                        </div>

                        <!-- Recent Pull Requests -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <h4><i class="fas fa-list"></i> Recent Pull Requests</h4>
                                <div id="recent-prs-container">
                                    <!-- Dynamic content will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Azure DevOps Tab -->
                    <div class="tab-pane fade show active" id="azuredevops-pane" role="tabpanel">

                        <!-- Azure DevOps Analytics Summary -->
                        <div class="row mb-4" id="azuredevops-summary">
                            <!-- Dynamic content will be loaded here -->
                        </div>

                        <!-- Azure DevOps Charts -->
                        <div class="row">
                            <div class="col-12">
                                <h4><i class="fas fa-chart-area"></i> Azure DevOps Analytics</h4>
                            </div>
                        </div>

                        <!-- Azure DevOps Charts -->
                        <div class="row">
                            <div class="col-12">
                                <h4><i class="fas fa-chart-area"></i> Azure DevOps Analytics Charts</h4>
                            </div>
                        </div>

                        <div id="azuredevops-charts-container">
                            <!-- Dynamic charts will be loaded here -->
                        </div>

                        <!-- Recent Work Items -->
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <h4><i class="fas fa-tasks"></i> Recent Work Items</h4>
                                <div id="recent-workitems-container">
                                    <!-- Dynamic content will be loaded here -->
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h4><i class="fas fa-code-branch"></i> Recent Pull Requests</h4>
                                <div id="recent-azuredevops-prs-container">
                                    <!-- Dynamic content will be loaded here -->
                                </div>
                            </div>
                        </div>

                        <!-- Recent Builds -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <h4><i class="fas fa-hammer"></i> Recent Builds</h4>
                                <div id="recent-builds-container">
                                    <!-- Dynamic content will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Figma Tab -->
                    <div class="tab-pane fade" id="figma-pane" role="tabpanel">

                        <!-- Figma Analytics Summary -->
                        <div class="row mb-4" id="figma-summary">
                            <!-- Dynamic content will be loaded here -->
                        </div>

                        <!-- Figma Charts -->
                        <div class="row">
                            <div class="col-12">
                                <h4><i class="fas fa-chart-area"></i> Figma Analytics</h4>
                            </div>
                        </div>

                        <div id="figma-charts-container">
                            <!-- Dynamic charts will be loaded here -->
                        </div>

                        <!-- Recent Files and Projects -->
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <h4><i class="fas fa-folder"></i> Recent Files</h4>
                                <div id="recent-figma-files-container">
                                    <!-- Dynamic content will be loaded here -->
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h4><i class="fas fa-users"></i> Active Collaborators</h4>
                                <div id="figma-collaborators-container">
                                    <!-- Dynamic content will be loaded here -->
                                </div>
                            </div>
                        </div>

                        <!-- Search Results -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <h4><i class="fas fa-search"></i> Search Results</h4>
                                <div id="figma-search-results-container">
                                    <!-- Dynamic content will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Datadog Dashboards Tab Content -->
    <div class="tab-pane fade" id="datadog-dashboards-pane" role="tabpanel">
        <div class="container-fluid">
            <div class="row">
                <!-- Sidebar for Dashboards -->
                <div class="col-md-3 sidebar" id="dashboards-sidebar">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-tachometer-alt"></i> Dashboard Controls</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <button class="btn btn-primary w-100" onclick="loadDashboardsSummary()">
                                    <i class="fas fa-sync"></i> Load Dashboards
                                </button>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Dashboard Filter</label>
                                <input type="text" class="form-control" id="dashboard-search" placeholder="Search dashboards...">
                            </div>
                            <div class="mb-3">
                                <button class="btn btn-info w-100" onclick="filterDashboards()">
                                    <i class="fas fa-search"></i> Filter
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main Content for Dashboards -->
                <div class="col-md-9">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-tachometer-alt"></i> Datadog Dashboards</h5>
                        </div>
                        <div class="card-body">
                            <!-- Dashboard Summary Cards -->
                            <div id="dashboards-summary" class="row mb-4">
                                <!-- Summary cards will be loaded here -->
                            </div>

                            <!-- Dashboard List -->
                            <div id="dashboards-list">
                                <div class="text-center">
                                    <i class="fas fa-tachometer-alt fa-3x text-muted mb-3"></i>
                                    <p class="text-muted">Click "Load Dashboards" to view your Datadog dashboards</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let selectedMetrics = [];
        let currentTimeRange = 24;
        let currentChartType = 'line';

        // Load available metrics on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadAvailableMetrics();
            
            // Auto-select some default metrics for better user experience
            setTimeout(() => {
                const defaultMetrics = ['cpu', 'memory', 'disk'];
                defaultMetrics.forEach(metricId => {
                    const checkbox = document.getElementById(metricId);
                    if (checkbox) {
                        checkbox.checked = true;
                    }
                });
                
                // Update dashboard with default metrics
                updateDashboard();
            }, 500);
            
            // Handle tab switching
            const datadogTab = document.getElementById('datadog-tab');
            const datadogLogsTab = document.getElementById('datadog-logs-tab');
            const githubTab = document.getElementById('github-tab');
            const azuredevopsTab = document.getElementById('azuredevops-tab');
            const figmaTab = document.getElementById('figma-tab');
            const datadogSidebar = document.getElementById('datadog-sidebar');
            const githubSidebar = document.getElementById('github-sidebar');
            const azuredevopsSidebar = document.getElementById('azuredevops-sidebar');
            const figmaSidebar = document.getElementById('figma-sidebar');
            
            datadogTab.addEventListener('click', function() {
                datadogSidebar.style.display = 'block';
                githubSidebar.style.display = 'none';
                azuredevopsSidebar.style.display = 'none';
                figmaSidebar.style.display = 'none';
            });
            
            datadogLogsTab.addEventListener('click', function() {
                datadogSidebar.style.display = 'none';
                githubSidebar.style.display = 'none';
                azuredevopsSidebar.style.display = 'none';
                figmaSidebar.style.display = 'none';
            });
            
            githubTab.addEventListener('click', function() {
                datadogSidebar.style.display = 'none';
                githubSidebar.style.display = 'block';
                azuredevopsSidebar.style.display = 'none';
                figmaSidebar.style.display = 'none';
            });
            
            azuredevopsTab.addEventListener('click', function() {
                datadogSidebar.style.display = 'none';
                githubSidebar.style.display = 'none';
                azuredevopsSidebar.style.display = 'block';  // Show Azure DevOps sidebar
                figmaSidebar.style.display = 'none';
            });
            
            figmaTab.addEventListener('click', function() {
                datadogSidebar.style.display = 'none';
                githubSidebar.style.display = 'none';
                azuredevopsSidebar.style.display = 'none';
                figmaSidebar.style.display = 'block';
            });
            
            // Show Azure DevOps sidebar by default since it's the active tab
            azuredevopsSidebar.style.display = 'block';
            datadogSidebar.style.display = 'none';
            githubSidebar.style.display = 'none';
            figmaSidebar.style.display = 'none';
        });

        async function loadAvailableMetrics() {
            try {
                const response = await fetch('/api/metrics');
                const metrics = await response.json();
                
                const metricsList = document.getElementById('metrics-list');
                
                // Add any new metrics that aren't already in the list
                const existingMetrics = Array.from(metricsList.querySelectorAll('input[type="checkbox"]')).map(cb => cb.value);
                
                metrics.forEach(metric => {
                    if (!existingMetrics.includes(metric)) {
                        const div = document.createElement('div');
                        div.className = 'form-check';
                        div.innerHTML = `
                            <input class="form-check-input" type="checkbox" value="${metric}" id="${metric.replace(/[^a-zA-Z0-9]/g, '_')}">
                            <label class="form-check-label" for="${metric.replace(/[^a-zA-Z0-9]/g, '_')}">
                                ${metric}
                            </label>
                        `;
                        metricsList.appendChild(div);
                    }
                });
            } catch (error) {
                console.error('Error loading metrics:', error);
            }
        }

        function addCustomMetric() {
            const customMetricInput = document.getElementById('custom-metric');
            const metricName = customMetricInput.value.trim();
            
            if (!metricName) {
                alert('Please enter a metric name');
                return;
            }
            
            // Check if metric already exists
            const existingCheckbox = document.querySelector(`input[value="${metricName}"]`);
            if (existingCheckbox) {
                alert('Metric already exists in the list');
                return;
            }
            
            // Add the custom metric
            const metricsList = document.getElementById('metrics-list');
            const div = document.createElement('div');
            div.className = 'form-check';
            div.innerHTML = `
                <input class="form-check-input" type="checkbox" value="${metricName}" id="${metricName.replace(/[^a-zA-Z0-9]/g, '_')}" checked>
                <label class="form-check-label" for="${metricName.replace(/[^a-zA-Z0-9]/g, '_')}">
                    ${metricName}
                </label>
            `;
            metricsList.appendChild(div);
            
            // Clear the input
            customMetricInput.value = '';
            
            // Update dashboard with new metric
            updateDashboard();
        }

        function getSelectedMetrics() {
            const checkboxes = document.querySelectorAll('#metrics-list input[type="checkbox"]:checked');
            return Array.from(checkboxes).map(cb => cb.value);
        }

        async function updateDashboard() {
            selectedMetrics = getSelectedMetrics();
            currentTimeRange = document.getElementById('time-range').value;
            currentChartType = document.getElementById('chart-type').value;

            if (selectedMetrics.length === 0) {
                // Show a friendly message instead of an alert
                const container = document.getElementById('metrics-summary');
                container.innerHTML = '<div class="col-12"><div class="alert alert-info"><i class="fas fa-info-circle"></i> Please select one or more metrics from the sidebar to view analytics.</div></div>';
                
                const chartsContainer = document.getElementById('charts-container');
                chartsContainer.innerHTML = '<div class="col-12"><div class="alert alert-info"><i class="fas fa-chart-line"></i> Select metrics to display charts and analytics.</div></div>';
                return;
            }

            // Update metrics summary
            await updateMetricsSummary();
            
            // Update charts
            await updateCharts();
        }

        async function updateMetricsSummary() {
            try {
                const params = new URLSearchParams();
                selectedMetrics.forEach(metric => params.append('metrics', metric));
                params.append('hours', currentTimeRange);

                const response = await fetch(`/api/analytics?${params}`);
                const result = await response.json();

                if (result.status === 'success') {
                    displayMetricsSummary(result.data);
                } else {
                    console.error('Error updating metrics summary:', result.message);
                    displayError('Failed to load metrics summary: ' + result.message);
                }
            } catch (error) {
                console.error('Error updating metrics summary:', error);
                displayError('Error connecting to Datadog API');
            }
        }

        function displayMetricsSummary(data) {
            const container = document.getElementById('metrics-summary');
            container.innerHTML = '';

            if (data.metrics_summary && data.metrics_summary.length > 0) {
                data.metrics_summary.forEach(metric => {
                    const col = document.createElement('div');
                    col.className = 'col-md-3 mb-3';
                    col.innerHTML = `
                        <div class="card metric-card h-100">
                            <div class="card-body">
                                <h6 class="card-title">${metric.metric_name}</h6>
                                <div class="row">
                                    <div class="col-6">
                                        <small class="text-muted">Avg</small>
                                        <div class="fw-bold">${metric.avg_value.toFixed(2)}</div>
                                    </div>
                                    <div class="col-6">
                                        <small class="text-muted">Max</small>
                                        <div class="fw-bold">${metric.max_value.toFixed(2)}</div>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <small class="text-muted">Data Points: ${metric.data_points}</small>
                                </div>
                            </div>
                        </div>
                    `;
                    container.appendChild(col);
                });
            } else {
                container.innerHTML = '<div class="col-12"><div class="alert alert-info">No metrics data available for the selected time range.</div></div>';
            }
        }

        function displayError(message) {
            const container = document.getElementById('metrics-summary');
            container.innerHTML = `<div class="col-12"><div class="alert alert-danger">${message}</div></div>`;
        }

        async function updateCharts() {
            const container = document.getElementById('charts-container');
            container.innerHTML = '';

            for (const metric of selectedMetrics) {
                try {
                    const response = await fetch(`/api/charts/${metric}?hours=${currentTimeRange}&type=${currentChartType}`);
                    const result = await response.json();

                    if (result.status === 'success') {
                        const chartDiv = document.createElement('div');
                        chartDiv.className = 'col-md-6 mb-4';
                        chartDiv.innerHTML = `
                            <div class="chart-container">
                                <h5>${metric}</h5>
                                <div id="chart-${metric.replace(/[^a-zA-Z0-9]/g, '_')}" style="height: 400px;"></div>
                            </div>
                        `;
                        container.appendChild(chartDiv);

                        // Render the chart
                        const chartData = JSON.parse(result.chart);
                        Plotly.newPlot(`chart-${metric.replace(/[^a-zA-Z0-9]/g, '_')}`, chartData.data, chartData.layout);
                    } else {
                        console.error(`Error loading chart for ${metric}:`, result.message);
                        const errorDiv = document.createElement('div');
                        errorDiv.className = 'col-md-6 mb-4';
                        errorDiv.innerHTML = `
                            <div class="chart-container">
                                <h5>${metric}</h5>
                                <div class="alert alert-warning">No data available for this metric</div>
                            </div>
                        `;
                        container.appendChild(errorDiv);
                    }
                } catch (error) {
                    console.error(`Error loading chart for ${metric}:`, error);
                }
            }
        }

        // Auto-refresh every 5 minutes
        setInterval(updateDashboard, 300000);

        // GitHub Analytics Functions
        let githubConfigured = false;
        let selectedRepos = []; // Array to store multiple repositories

        function addGitHubRepo() {
            const repoInput = document.getElementById('github-repo-input');
            const repoPath = repoInput.value.trim();
            
            if (!repoPath) {
                alert('Please enter a repository path');
                return;
            }
            
            // Validate format (owner/repo)
            const parts = repoPath.split('/');
            if (parts.length !== 2 || !parts[0] || !parts[1]) {
                alert('Please enter repository in format: owner/repo (e.g., microsoft/vscode)');
                return;
            }
            
            // Check if repository already exists
            if (selectedRepos.includes(repoPath)) {
                alert('Repository already added');
                return;
            }
            
            selectedRepos.push(repoPath);
            repoInput.value = '';
            updateReposList();
            updateGitHubRepoInfo();
        }
        
        function removeRepo(repoPath) {
            const index = selectedRepos.indexOf(repoPath);
            if (index > -1) {
                selectedRepos.splice(index, 1);
                updateReposList();
                updateGitHubRepoInfo();
            }
        }
        
        function clearAllRepos() {
            selectedRepos = [];
            updateReposList();
            updateGitHubRepoInfo();
        }
        
        function updateReposList() {
            const container = document.getElementById('selected-repos');
            
            if (selectedRepos.length === 0) {
                container.innerHTML = '<small class="text-muted">No repositories selected</small>';
                githubConfigured = false;
                return;
            }
            
            githubConfigured = true;
            
            let html = '';
            selectedRepos.forEach(repo => {
                html += `
                    <div class="d-flex align-items-center justify-content-between mb-2 p-2 border rounded">
                        <small><strong>${repo}</strong></small>
                        <button class="btn btn-outline-danger btn-sm" onclick="removeRepo('${repo}')" title="Remove repository">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
            });
            container.innerHTML = html;
        }
        
        function updateGitHubRepoInfo() {
            const infoElement = document.getElementById('github-repo-info');
            if (selectedRepos.length === 0) {
                infoElement.textContent = 'None configured';
            } else if (selectedRepos.length === 1) {
                infoElement.textContent = selectedRepos[0];
            } else {
                infoElement.textContent = `${selectedRepos.length} repositories`;
            }
        }

        async function syncRepositoriesFromAzureDevOps() {
            const button = event.target.closest('button');
            const originalText = button.innerHTML;
            
            try {
                // Show loading state
                button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Syncing...';
                button.disabled = true;
                
                // Get Azure DevOps configuration
                const org = document.getElementById('azuredevops-org').value || azuredevopsOrg;
                const project = document.getElementById('azuredevops-project').value || azuredevopsProject;
                const areaPath = document.getElementById('azuredevops-area-path').value || azuredevopsAreaPath;
                const days = document.getElementById('github-time-range').value || 30;
                
                if (!org || !project) {
                    alert('Please configure Azure DevOps organization and project first in the Azure DevOps tab.');
                    return;
                }
                
                // Build API URL
                const params = new URLSearchParams({
                    days: days,
                    org: org,
                    project: project
                });
                
                if (areaPath) {
                    params.append('area_path', areaPath);
                }
                
                // Fetch repositories from Azure DevOps
                const response = await fetch(`/api/azuredevops/repositories?${params}`);
                const result = await response.json();
                
                if (result.status === 'success' && result.repositories.length > 0) {
                    // Clear existing repositories
                    selectedRepos.length = 0;
                    
                    // Add repositories from Azure DevOps
                    let addedCount = 0;
                    let resolvedCount = 0;
                    result.repositories.forEach(repo => {
                        // Use the actual resolved GitHub repository name
                        const repoFormat = repo.github_repo;
                        if (!selectedRepos.includes(repoFormat)) {
                            selectedRepos.push(repoFormat);
                            addedCount++;
                            if (repo.resolved) {
                                resolvedCount++;
                            }
                        }
                    });
                    
                    // Update UI
                    updateReposList();
                    updateGitHubRepoInfo();
                    
                    // Show success message
                    button.innerHTML = '<i class="fas fa-check text-success"></i> Synced!';
                    setTimeout(() => {
                        button.innerHTML = originalText;
                        button.disabled = false;
                    }, 2000);
                    
                    // Show info about what was synced
                    const resolvedMessage = resolvedCount > 0 ? 
                        `✅ ${resolvedCount} repositories resolved to actual GitHub names\n` : '';
                    const unresolvedMessage = (addedCount - resolvedCount) > 0 ? 
                        `⚠️ ${addedCount - resolvedCount} repositories could not be resolved (using fallback names)\n` : '';
                    
                    alert(`🔗 Successfully synced ${addedCount} repositories from Azure DevOps!\n\n${resolvedMessage}${unresolvedMessage}\nRepositories added:\n${selectedRepos.join('\n')}`);
                    
                } else if (result.repositories && result.repositories.length === 0) {
                    alert('No GitHub repositories found in Azure DevOps work items for the selected time range and area path.');
                } else {
                    alert(`Failed to sync repositories: ${result.message || 'Unknown error'}`);
                }
                
            } catch (error) {
                console.error('Error syncing repositories:', error);
                alert(`Error syncing repositories: ${error.message}`);
            } finally {
                // Reset button state if not already done
                if (button.disabled) {
                    button.innerHTML = originalText;
                    button.disabled = false;
                }
            }
        }

        async function updateGitHubDashboard() {
            if (!githubConfigured || selectedRepos.length === 0) {
                document.getElementById('github-summary').innerHTML = '<div class="col-12"><div class="alert alert-info">Please add at least one GitHub repository first.</div></div>';
                return;
            }

            const days = document.getElementById('github-time-range').value;
            const chartType = document.getElementById('github-chart-type').value;

            // Update GitHub analytics summary
            await updateGitHubSummary(days);
            
            // Update GitHub charts
            await updateGitHubCharts(days, chartType);
            
            // Update recent PRs
            await updateRecentPRs(days);
        }

        async function updateGitHubSummary(days) {
            try {
                // Send multiple repositories as URL parameters
                const repoParams = selectedRepos.map(repo => `repos=${encodeURIComponent(repo)}`).join('&');
                const response = await fetch(`/api/github/prs?days=${days}&${repoParams}`);
                const result = await response.json();

                if (result.status === 'success') {
                    displayGitHubSummary(result.data);
                } else {
                    console.error('Error updating GitHub summary:', result.message);
                    displayGitHubError('Failed to load GitHub analytics: ' + result.message);
                }
            } catch (error) {
                console.error('Error updating GitHub summary:', error);
                displayGitHubError('Error connecting to GitHub API');
            }
        }

        function displayGitHubSummary(data) {
            const container = document.getElementById('github-summary');
            container.innerHTML = '';

            const summaryCards = [
                {
                    title: 'Total PRs',
                    value: data.total_prs,
                    icon: 'fas fa-code-branch',
                    color: 'primary'
                },
                {
                    title: 'Open PRs',
                    value: data.open_prs,
                    icon: 'fas fa-clock',
                    color: 'warning'
                },
                {
                    title: 'Merged PRs',
                    value: data.merged_prs,
                    icon: 'fas fa-check',
                    color: 'success'
                },
                {
                    title: 'Avg Commits',
                    value: data.average_commits.toFixed(1),
                    icon: 'fas fa-commit',
                    color: 'info'
                }
            ];

            summaryCards.forEach(card => {
                const col = document.createElement('div');
                col.className = 'col-md-3 mb-3';
                col.innerHTML = `
                    <div class="card metric-card h-100">
                        <div class="card-body text-center">
                            <i class="${card.icon} fa-2x text-${card.color} mb-2"></i>
                            <h5 class="card-title">${card.value}</h5>
                            <p class="card-text text-muted">${card.title}</p>
                        </div>
                    </div>
                `;
                container.appendChild(col);
            });
        }

        function displayGitHubError(message) {
            const container = document.getElementById('github-summary');
            container.innerHTML = `<div class="col-12"><div class="alert alert-danger">${message}</div></div>`;
        }

        function displaySummaryTable(tableData) {
            const container = document.getElementById('github-summary-table');
            
            // Generate table HTML
            let tableHtml = '<div class="table-responsive"><table class="table table-striped table-hover">';
            
            // Add headers
            tableHtml += '<thead class="table-dark"><tr>';
            tableData.headers.forEach(header => {
                tableHtml += `<th>${header}</th>`;
            });
            tableHtml += '</tr></thead>';
            
            // Add rows
            tableHtml += '<tbody>';
            tableData.rows.forEach((row, index) => {
                const isLastRow = index === tableData.rows.length - 1;
                const rowClass = isLastRow ? 'table-warning' : '';
                
                tableHtml += `<tr class="${rowClass}">`;
                row.forEach(cell => {
                    tableHtml += `<td>${cell}</td>`;
                });
                tableHtml += '</tr>';
            });
            tableHtml += '</tbody>';
            
            tableHtml += '</table></div>';
            
            // Add some summary statistics cards
            const lastRow = tableData.rows[tableData.rows.length - 1];
            const totalPRs = parseInt(lastRow[1].replace(/<\/?strong>/g, ''));
            const totalMerged = parseInt(lastRow[4].replace(/<\/?strong>/g, ''));
            
            tableHtml += `
                <div class="mt-3">
                    <div class="row text-center">
                        <div class="col-md-3">
                            <div class="card bg-primary text-white">
                                <div class="card-body">
                                    <h5>${tableData.rows.length - 1}</h5>
                                    <small>Repositories</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-info text-white">
                                <div class="card-body">
                                    <h5>${totalPRs}</h5>
                                    <small>Total PRs</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-success text-white">
                                <div class="card-body">
                                    <h5>${totalMerged}</h5>
                                    <small>Merged PRs</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-warning text-white">
                                <div class="card-body">
                                    <h5>${lastRow[5].replace(/<\/?strong>/g, '')}</h5>
                                    <small>Merge Rate</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            container.innerHTML = tableHtml;
        }

        async function updateGitHubCharts(days, chartType) {
            const container = document.getElementById('github-charts-container');
            container.innerHTML = '';

            try {
                // Send multiple repositories as URL parameters
                const repoParams = selectedRepos.map(repo => `repos=${encodeURIComponent(repo)}`).join('&');
                const response = await fetch(`/api/github/prs/chart?days=${days}&type=${chartType}&${repoParams}`);
                const result = await response.json();

                if (result.status === 'success') {
                    const chartDiv = document.createElement('div');
                    chartDiv.className = 'col-12 mb-4';
                    
                    // Check if this is a table or a chart
                    if (result.chart_type === 'summary' && result.chart.type === 'table') {
                        // Display as table
                        chartDiv.innerHTML = `
                            <div class="chart-container">
                                <h5>Repository Summary</h5>
                                <div id="github-summary-table"></div>
                            </div>
                        `;
                        container.appendChild(chartDiv);
                        
                        // Generate the table HTML
                        displaySummaryTable(result.chart);
                        
                    } else {
                        // Display as chart
                        chartDiv.innerHTML = `
                            <div class="chart-container">
                                <div id="github-chart" style="height: 500px;"></div>
                            </div>
                        `;
                        container.appendChild(chartDiv);

                        // Render the chart
                        const chartData = JSON.parse(result.chart);
                        Plotly.newPlot('github-chart', chartData.data, chartData.layout);
                    }
                } else {
                    console.error('Error loading GitHub chart:', result.message);
                    container.innerHTML = '<div class="col-12"><div class="alert alert-warning">No data available for GitHub analytics</div></div>';
                }
            } catch (error) {
                console.error('Error loading GitHub chart:', error);
                container.innerHTML = '<div class="col-12"><div class="alert alert-danger">Error loading GitHub chart</div></div>';
            }
        }

        async function updateRecentPRs(days) {
            try {
                const response = await fetch(`/api/github/prs?days=${days}`);
                const result = await response.json();

                if (result.status === 'success' && result.data.recent_prs) {
                    displayRecentPRs(result.data.recent_prs);
                } else {
                    document.getElementById('recent-prs-container').innerHTML = '<div class="alert alert-info">No recent pull requests found.</div>';
                }
            } catch (error) {
                console.error('Error loading recent PRs:', error);
                document.getElementById('recent-prs-container').innerHTML = '<div class="alert alert-danger">Error loading recent pull requests</div>';
            }
        }

        function displayRecentPRs(prs) {
            const container = document.getElementById('recent-prs-container');
            container.innerHTML = '';

            prs.forEach(pr => {
                const prDiv = document.createElement('div');
                prDiv.className = 'card mb-3';
                
                const stateClass = pr.state === 'open' ? 'success' : pr.merged_at ? 'primary' : 'secondary';
                const stateIcon = pr.state === 'open' ? 'fas fa-clock' : pr.merged_at ? 'fas fa-check' : 'fas fa-times';
                
                prDiv.innerHTML = `
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-8">
                                <h6 class="card-title">
                                    <a href="${pr.html_url}" target="_blank" class="text-decoration-none">
                                        #${pr.number} ${pr.title}
                                    </a>
                                </h6>
                                <p class="card-text text-muted">${pr.body ? pr.body.substring(0, 100) + '...' : 'No description'}</p>
                            </div>
                            <div class="col-md-4 text-end">
                                <span class="badge bg-${stateClass} mb-2">
                                    <i class="${stateIcon}"></i> ${pr.state}
                                </span>
                                <div class="text-muted">
                                    <small>By ${pr.user.login}</small><br>
                                    <small>${new Date(pr.created_at).toLocaleDateString()}</small>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(prDiv);
            });
        }

        // Azure DevOps Analytics Functions
        let azuredevopsConfigured = false;
        let azuredevopsOrg = '';
        let azuredevopsProject = '';
        let azuredevopsAreaPath = '';

        function configureAzureDevOps() {
            const org = document.getElementById('azuredevops-org').value.trim();
            const project = document.getElementById('azuredevops-project').value.trim();
            const areaPath = document.getElementById('azuredevops-area-path').value.trim();
            
            if (!org || !project) {
                alert('Please enter both organization and project name');
                return;
            }
            
            azuredevopsOrg = org;
            azuredevopsProject = project;
            azuredevopsAreaPath = areaPath;
            azuredevopsConfigured = true;
            
            document.getElementById('azuredevops-project-info').textContent = `${org}/${project}`;
            document.getElementById('azuredevops-area-info').textContent = areaPath || 'Project root';
            
            // Update Azure DevOps dashboard
            updateAzureDevOpsDashboard();
        }

        async function updateAzureDevOpsDashboard() {
            if (!azuredevopsConfigured) {
                document.getElementById('azuredevops-summary').innerHTML = '<div class="col-12"><div class="alert alert-info">Please configure Azure DevOps project first.</div></div>';
                return;
            }

            const days = document.getElementById('azuredevops-time-range').value;
            const chartType = document.getElementById('azuredevops-chart-type').value;

            // Update Azure DevOps analytics summary
            await updateAzureDevOpsSummary(days);
            
            // Update charts with selected type
            await updateAzureDevOpsCharts(days, chartType);
            
            // Update recent items
            await updateRecentAzureDevOpsItems(days);
        }

        async function updateAzureDevOpsSummary(days) {
            const analysisMode = document.getElementById('azuredevops-analysis-mode').value;
            const isDetailedMode = analysisMode === 'detailed';
            
            // Show loading spinner with mode-specific messaging
            const container = document.getElementById('azuredevops-summary');
            container.innerHTML = `
                <div class="col-12 text-center py-5">
                    <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <div class="mt-3">
                        <h6 class="text-muted">${isDetailedMode ? '🔍 Loading Detailed Analytics...' : '🚀 Loading Fast Analytics...'}</h6>
                        <small class="text-muted">
                            ${isDetailedMode 
                                ? `Analyzing work items + PR relations (${days} days) - This may take 1-2 minutes`
                                : `Fetching work items for the last ${days} days - Should complete in 1-2 seconds`
                            }
                        </small>
                        <div class="progress mt-2" style="height: 4px; width: 250px; margin: 0 auto;">
                            <div class="progress-bar progress-bar-striped progress-bar-animated ${isDetailedMode ? 'bg-warning' : 'bg-success'}" 
                                 role="progressbar" style="width: 100%"></div>
                        </div>
                    </div>
                </div>
            `;
            
            try {
                console.log(`🚀 Fetching Azure DevOps analytics (${analysisMode} mode) for ${days} days...`);
                const startTime = performance.now();
                
                // Build query parameters
                const params = new URLSearchParams({
                    days: days,
                    org: azuredevopsOrg,
                    project: azuredevopsProject
                });
                
                if (azuredevopsAreaPath) {
                    params.append('area_path', azuredevopsAreaPath);
                }
                
                // Choose endpoint based on analysis mode
                const endpoint = isDetailedMode 
                    ? `/api/azuredevops/analytics-detailed?${params}`
                    : `/api/azuredevops/analytics?${params}`;
                
                const response = await fetch(endpoint);
                const result = await response.json();
                
                const endTime = performance.now();
                const loadTime = (endTime - startTime).toFixed(2);
                console.log(`⚡ Azure DevOps analytics (${analysisMode}) loaded in ${loadTime}ms`);

                if (result.status === 'success') {
                    displayAzureDevOpsSummary(result.data);
                    
                    // Show performance note
                    if (result.data.performance_note) {
                        console.log(`📊 ${result.data.performance_note}`);
                    }
                } else {
                    console.error('Error updating Azure DevOps summary:', result.message);
                    displayAzureDevOpsError('Failed to load Azure DevOps analytics: ' + result.message);
                }
            } catch (error) {
                console.error('Error updating Azure DevOps summary:', error);
                displayAzureDevOpsError('Error connecting to Azure DevOps API: ' + error.message);
            }
        }

        function displayAzureDevOpsSummary(data) {
            const container = document.getElementById('azuredevops-summary');
            container.innerHTML = '';

            const summaryCards = [
                {
                    title: 'Work Items',
                    value: data.total_work_items,
                    icon: 'fas fa-tasks',
                    color: 'primary',
                    subtitle: `Last ${document.getElementById('azuredevops-time-range').value} days`
                },
                {
                    title: 'Pull Requests',
                    value: data.total_pull_requests,
                    icon: 'fas fa-code-branch',
                    color: 'success',
                    subtitle: 'Linked to work items'
                },
                {
                    title: 'Commits',
                    value: data.total_commits || 0,
                    icon: 'fas fa-commit',
                    color: 'info',
                    subtitle: 'Code changes'
                },
                {
                    title: 'Repositories',
                    value: data.total_repositories,
                    icon: 'fas fa-folder-open',
                    color: 'warning',
                    subtitle: 'Active repos'
                }
            ];

            summaryCards.forEach(card => {
                const col = document.createElement('div');
                col.className = 'col-md-3 mb-3';
                col.innerHTML = `
                    <div class="card metric-card h-100">
                        <div class="card-body text-center">
                            <i class="${card.icon} fa-2x text-${card.color} mb-2"></i>
                            <h5 class="card-title">${card.value}</h5>
                            <p class="card-text text-muted">${card.title}</p>
                        </div>
                    </div>
                `;
                container.appendChild(col);
            });
        }

        function displayAzureDevOpsError(message) {
            const container = document.getElementById('azuredevops-summary');
            container.innerHTML = `<div class="col-12"><div class="alert alert-danger">${message}</div></div>`;
        }

        async function updateAzureDevOpsCharts(days, chartType) {
            const container = document.getElementById('azuredevops-charts-container');
            const analysisMode = document.getElementById('azuredevops-analysis-mode').value;
            const isDetailedMode = analysisMode === 'detailed';
            
            // Show loading for charts
            container.innerHTML = `
                <div class="col-12 text-center py-4">
                    <div class="spinner-border text-info" role="status">
                        <span class="visually-hidden">Loading chart...</span>
                    </div>
                    <div class="mt-2">
                        <small class="text-muted">Generating ${chartType} chart...</small>
                    </div>
                </div>
            `;

            try {
                // Build query parameters
                const params = new URLSearchParams({
                    days: days,
                    type: chartType,
                    org: azuredevopsOrg,
                    project: azuredevopsProject
                });
                
                if (azuredevopsAreaPath) {
                    params.append('area_path', azuredevopsAreaPath);
                }
                
                // Add analysis mode parameter for backend to use appropriate data
                if (isDetailedMode) {
                    params.append('detailed', 'true');
                }
                
                const response = await fetch(`/api/azuredevops/chart?${params}`);
                const result = await response.json();

                if (result.status === 'success') {
                    const chartDiv = document.createElement('div');
                    chartDiv.className = 'col-12 mb-4';
                    chartDiv.innerHTML = `
                        <div class="chart-container">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h5 class="mb-0">${getChartTitle(chartType)}</h5>
                                <small class="text-muted">${isDetailedMode ? '🔍 Detailed Analysis' : '🚀 Fast Mode'}</small>
                            </div>
                            <div id="azuredevops-chart" style="height: 500px;"></div>
                        </div>
                    `;
                    container.innerHTML = '';
                    container.appendChild(chartDiv);

                    // Render the chart
                    const chartData = JSON.parse(result.chart);
                    Plotly.newPlot('azuredevops-chart', chartData.data, chartData.layout, {responsive: true});
                } else {
                    console.error('Error loading Azure DevOps chart:', result.message);
                    container.innerHTML = `
                        <div class="col-12">
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle"></i> 
                                Chart Error: ${result.message || 'No data available for selected chart type'}
                                <br><small>Try switching to detailed mode for PR/repository charts.</small>
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error updating Azure DevOps charts:', error);
                container.innerHTML = `
                    <div class="col-12">
                        <div class="alert alert-danger">
                            <i class="fas fa-times-circle"></i> 
                            Failed to load chart: ${error.message}
                        </div>
                    </div>
                `;
            }
        }
        
        function getChartTitle(chartType) {
            const titles = {
                'overview': '📊 Activity Overview',
                'work_items_by_type': '🏷️ Work Items by Type',
                'work_items_by_state': '📋 Work Items by State', 
                'work_items_by_assignee': '👤 Work Items by Assignee',
                'prs_by_status': '🔀 Pull Requests by Status',
                'repositories_breakdown': '📁 Repository Breakdown'
            };
            return titles[chartType] || '📊 Azure DevOps Chart';
        }

        async function updateRecentAzureDevOpsItems(days) {
            try {
                // Build query parameters
                const params = new URLSearchParams({
                    days: days,
                    org: azuredevopsOrg,
                    project: azuredevopsProject
                });
                
                if (azuredevopsAreaPath) {
                    params.append('area_path', azuredevopsAreaPath);
                }
                
                const response = await fetch(`/api/azuredevops/analytics?${params}`);
                const result = await response.json();

                if (result.status === 'success' && result.data) {
                    displayRecentWorkItems(result.data.recent_work_items || []);
                    displayRecentAzureDevOpsPRs(result.data.recent_pull_requests || []);
                    displayRecentBuilds(result.data.recent_builds || []);
                } else {
                    document.getElementById('recent-workitems-container').innerHTML = '<div class="alert alert-info">No recent work items found.</div>';
                    document.getElementById('recent-azuredevops-prs-container').innerHTML = '<div class="alert alert-info">No recent pull requests found.</div>';
                    document.getElementById('recent-builds-container').innerHTML = '<div class="alert alert-info">No recent builds found.</div>';
                }
            } catch (error) {
                console.error('Error loading recent Azure DevOps items:', error);
                document.getElementById('recent-workitems-container').innerHTML = '<div class="alert alert-danger">Error loading recent work items</div>';
                document.getElementById('recent-azuredevops-prs-container').innerHTML = '<div class="alert alert-danger">Error loading recent pull requests</div>';
                document.getElementById('recent-builds-container').innerHTML = '<div class="alert alert-danger">Error loading recent builds</div>';
            }
        }

        function displayRecentWorkItems(workItems) {
            const container = document.getElementById('recent-workitems-container');
            container.innerHTML = '';

            workItems.forEach(item => {
                const fields = item.fields || {};
                const workItemDiv = document.createElement('div');
                workItemDiv.className = 'card mb-2';
                
                const stateClass = fields['System.State'] === 'Active' ? 'success' : 
                                 fields['System.State'] === 'Resolved' ? 'warning' : 'secondary';
                
                workItemDiv.innerHTML = `
                    <div class="card-body p-2">
                        <div class="row">
                            <div class="col-8">
                                <h6 class="card-title mb-1">
                                    <a href="https://dev.azure.com/${azuredevopsOrg}/${azuredevopsProject}/_workitems/edit/${item.id}" target="_blank" class="text-decoration-none">
                                        #${item.id} ${fields['System.Title'] || 'No Title'}
                                    </a>
                                </h6>
                                <small class="text-muted">${fields['System.WorkItemType'] || 'Unknown'}</small>
                            </div>
                            <div class="col-4 text-end">
                                <span class="badge bg-${stateClass}">${fields['System.State'] || 'Unknown'}</span>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(workItemDiv);
            });
        }

        function displayRecentAzureDevOpsPRs(prs) {
            const container = document.getElementById('recent-azuredevops-prs-container');
            container.innerHTML = '';

            prs.forEach(pr => {
                const prDiv = document.createElement('div');
                prDiv.className = 'card mb-2';
                
                const statusClass = pr.status === 'active' ? 'success' : 
                                  pr.status === 'completed' ? 'primary' : 'secondary';
                
                prDiv.innerHTML = `
                    <div class="card-body p-2">
                        <div class="row">
                            <div class="col-8">
                                <h6 class="card-title mb-1">
                                    <a href="${pr.url}" target="_blank" class="text-decoration-none">
                                        #${pr.pullRequestId} ${pr.title || 'No Title'}
                                    </a>
                                </h6>
                                <small class="text-muted">By ${pr.createdBy?.displayName || 'Unknown'}</small>
                            </div>
                            <div class="col-4 text-end">
                                <span class="badge bg-${statusClass}">${pr.status}</span>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(prDiv);
            });
        }

        function displayRecentBuilds(builds) {
            const container = document.getElementById('recent-builds-container');
            container.innerHTML = '';

            builds.forEach(build => {
                const buildDiv = document.createElement('div');
                buildDiv.className = 'card mb-2';
                
                const resultClass = build.result === 'succeeded' ? 'success' : 
                                  build.result === 'failed' ? 'danger' : 'warning';
                
                buildDiv.innerHTML = `
                    <div class="card-body p-2">
                        <div class="row">
                            <div class="col-8">
                                <h6 class="card-title mb-1">
                                    <a href="${build._links?.web?.href || '#'}" target="_blank" class="text-decoration-none">
                                        ${build.definition?.name || 'Unknown Build'}
                                    </a>
                                </h6>
                                <small class="text-muted">Build #${build.id}</small>
                            </div>
                            <div class="col-4 text-end">
                                <span class="badge bg-${resultClass}">${build.result || 'Unknown'}</span>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(buildDiv);
            });
        }

        // Figma Analytics Functions
        let figmaConfigured = false;
        let figmaTeamId = '';

        function configureFigma() {
            const teamId = document.getElementById('figma-team-id').value.trim();
            
            if (!teamId) {
                alert('Please enter your Figma Team ID');
                return;
            }
            
            figmaTeamId = teamId;
            figmaConfigured = true;
            
            document.getElementById('figma-team-info').textContent = teamId;
            
            // Update Figma dashboard
            updateFigmaDashboard();
        }

        async function updateFigmaDashboard() {
            if (!figmaConfigured) {
                document.getElementById('figma-summary').innerHTML = '<div class="col-12"><div class="alert alert-info">Please configure Figma team first.</div></div>';
                return;
            }

            const days = document.getElementById('figma-time-range').value;
            const chartType = document.getElementById('figma-chart-type').value;

            // Update Figma analytics summary
            await updateFigmaSummary(days);
            
            // Update Figma charts
            await updateFigmaCharts(days, chartType);
            
            // Update recent items
            await updateRecentFigmaItems(days);
        }

        async function updateFigmaSummary(days) {
            try {
                const response = await fetch(`/api/figma/analytics?days=${days}`);
                const result = await response.json();

                if (result.status === 'success') {
                    displayFigmaSummary(result.data);
                } else {
                    console.error('Error updating Figma summary:', result.message);
                    displayFigmaError('Failed to load Figma analytics: ' + result.message);
                }
            } catch (error) {
                console.error('Error updating Figma summary:', error);
                displayFigmaError('Error connecting to Figma API');
            }
        }

        function displayFigmaSummary(data) {
            const container = document.getElementById('figma-summary');
            container.innerHTML = '';

            const summaryCards = [
                {
                    title: 'Projects',
                    value: data.total_projects,
                    icon: 'fas fa-folder',
                    color: 'primary'
                },
                {
                    title: 'Files',
                    value: data.total_files,
                    icon: 'fas fa-file',
                    color: 'success'
                },
                {
                    title: 'Comments',
                    value: data.total_comments,
                    icon: 'fas fa-comments',
                    color: 'warning'
                },
                {
                    title: 'Collaborators',
                    value: data.active_collaborators.length,
                    icon: 'fas fa-users',
                    color: 'info'
                }
            ];

            summaryCards.forEach(card => {
                const col = document.createElement('div');
                col.className = 'col-md-3 mb-3';
                col.innerHTML = `
                    <div class="card metric-card h-100">
                        <div class="card-body text-center">
                            <i class="${card.icon} fa-2x text-${card.color} mb-2"></i>
                            <h5 class="card-title">${card.value}</h5>
                            <p class="card-text text-muted">${card.title}</p>
                        </div>
                    </div>
                `;
                container.appendChild(col);
            });
        }

        function displayFigmaError(message) {
            const container = document.getElementById('figma-summary');
            container.innerHTML = `<div class="col-12"><div class="alert alert-danger">${message}</div></div>`;
        }

        async function updateFigmaCharts(days, chartType) {
            const container = document.getElementById('figma-charts-container');
            container.innerHTML = '';

            try {
                const response = await fetch(`/api/figma/chart?days=${days}&type=${chartType}`);
                const result = await response.json();

                if (result.status === 'success') {
                    const chartDiv = document.createElement('div');
                    chartDiv.className = 'col-12 mb-4';
                    chartDiv.innerHTML = `
                        <div class="chart-container">
                            <div id="figma-chart" style="height: 500px;"></div>
                        </div>
                    `;
                    container.appendChild(chartDiv);

                    // Render the chart
                    const chartData = JSON.parse(result.chart);
                    Plotly.newPlot('figma-chart', chartData.data, chartData.layout);
                } else {
                    console.error('Error loading Figma chart:', result.message);
                    container.innerHTML = '<div class="col-12"><div class="alert alert-warning">No data available for Figma analytics</div></div>';
                }
            } catch (error) {
                console.error('Error loading Figma chart:', error);
                container.innerHTML = '<div class="col-12"><div class="alert alert-danger">Error loading Figma chart</div></div>';
            }
        }

        async function updateRecentFigmaItems(days) {
            try {
                const response = await fetch(`/api/figma/analytics?days=${days}`);
                const result = await response.json();

                if (result.status === 'success' && result.data) {
                    displayRecentFigmaFiles(result.data.recent_files || []);
                    displayFigmaCollaborators(result.data.active_collaborators || []);
                } else {
                    document.getElementById('recent-figma-files-container').innerHTML = '<div class="alert alert-info">No recent files found.</div>';
                    document.getElementById('figma-collaborators-container').innerHTML = '<div class="alert alert-info">No collaborators found.</div>';
                }
            } catch (error) {
                console.error('Error loading recent Figma items:', error);
                document.getElementById('recent-figma-files-container').innerHTML = '<div class="alert alert-danger">Error loading recent files</div>';
                document.getElementById('figma-collaborators-container').innerHTML = '<div class="alert alert-danger">Error loading collaborators</div>';
            }
        }

        function displayRecentFigmaFiles(files) {
            const container = document.getElementById('recent-figma-files-container');
            container.innerHTML = '';

            files.slice(0, 10).forEach(file => {
                const fileDiv = document.createElement('div');
                fileDiv.className = 'card mb-2';
                
                fileDiv.innerHTML = `
                    <div class="card-body p-2">
                        <div class="row">
                            <div class="col-8">
                                <h6 class="card-title mb-1">
                                    <a href="https://www.figma.com/file/${file.key}" target="_blank" class="text-decoration-none">
                                        ${file.name || 'Untitled'}
                                    </a>
                                </h6>
                                <small class="text-muted">${file.comments_count || 0} comments</small>
                            </div>
                            <div class="col-4 text-end">
                                <small class="text-muted">v${file.version || '1'}</small>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(fileDiv);
            });
        }

        function displayFigmaCollaborators(collaborators) {
            const container = document.getElementById('figma-collaborators-container');
            container.innerHTML = '';

            collaborators.forEach(collaborator => {
                const collaboratorDiv = document.createElement('div');
                collaboratorDiv.className = 'card mb-2';
                
                collaboratorDiv.innerHTML = `
                    <div class="card-body p-2">
                        <div class="d-flex align-items-center">
                            <div class="avatar bg-primary text-white rounded-circle me-2" style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;">
                                ${collaborator.charAt(0).toUpperCase()}
                            </div>
                            <div>
                                <h6 class="mb-0">${collaborator}</h6>
                                <small class="text-muted">Active collaborator</small>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(collaboratorDiv);
            });
        }

        async function searchFigmaFiles() {
            const query = document.getElementById('figma-search').value.trim();
            
            if (!query) {
                alert('Please enter a search term');
                return;
            }

            try {
                const response = await fetch(`/api/figma/search?q=${encodeURIComponent(query)}`);
                const result = await response.json();

                if (result.status === 'success') {
                    displayFigmaSearchResults(result.data);
                } else {
                    console.error('Error searching Figma files:', result.message);
                    document.getElementById('figma-search-results-container').innerHTML = '<div class="alert alert-danger">Search failed: ' + result.message + '</div>';
                }
            } catch (error) {
                console.error('Error searching Figma files:', error);
                document.getElementById('figma-search-results-container').innerHTML = '<div class="alert alert-danger">Error searching files</div>';
            }
        }

        function displayFigmaSearchResults(results) {
            const container = document.getElementById('figma-search-results-container');
            container.innerHTML = '';

            if (results.length === 0) {
                container.innerHTML = '<div class="alert alert-info">No files found matching your search.</div>';
                return;
            }

            results.forEach(file => {
                const fileDiv = document.createElement('div');
                fileDiv.className = 'card mb-2';
                
                fileDiv.innerHTML = `
                    <div class="card-body p-2">
                        <div class="row">
                            <div class="col-8">
                                <h6 class="card-title mb-1">
                                    <a href="https://www.figma.com/file/${file.key}" target="_blank" class="text-decoration-none">
                                        ${file.name || 'Untitled'}
                                    </a>
                                </h6>
                                <small class="text-muted">Project: ${file.project || 'Unknown'}</small>
                            </div>
                            <div class="col-4 text-end">
                                <small class="text-muted">${new Date(file.last_modified).toLocaleDateString()}</small>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(fileDiv);
            });
        }

        // Datadog Logs Functions
        async function loadLogsSummary() {
            try {
                const hours = document.getElementById('logs-time-range')?.value || 24;
                const response = await fetch(`/api/datadog/logs/summary?hours=${hours}`);
                const result = await response.json();

                if (result.status === 'success') {
                    displayLogsSummary(result.data);
                } else {
                    console.error('Error loading logs summary:', result.message);
                    displayLogsError('Failed to load logs summary: ' + result.message);
                }
            } catch (error) {
                console.error('Error loading logs summary:', error);
                displayLogsError('Error connecting to logs API');
            }
        }

        function displayLogsSummary(data) {
            const container = document.getElementById('logs-summary');
            container.innerHTML = '';

            // Total Logs Card
            const totalCard = document.createElement('div');
            totalCard.className = 'col-md-3 mb-3';
            totalCard.innerHTML = `
                <div class="card text-white bg-primary">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h4 class="card-title">${data.total_logs.toLocaleString()}</h4>
                                <p class="card-text">Total Logs</p>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-file-alt fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            container.appendChild(totalCard);

            // Log Levels Cards
            Object.entries(data.log_levels).forEach(([level, count]) => {
                const levelCard = document.createElement('div');
                levelCard.className = 'col-md-3 mb-3';
                
                let bgColor = 'bg-info';
                let icon = 'fas fa-info-circle';
                if (level === 'error') {
                    bgColor = 'bg-danger';
                    icon = 'fas fa-exclamation-triangle';
                } else if (level === 'warning') {
                    bgColor = 'bg-warning';
                    icon = 'fas fa-exclamation-circle';
                } else if (level === 'debug') {
                    bgColor = 'bg-secondary';
                    icon = 'fas fa-bug';
                }

                levelCard.innerHTML = `
                    <div class="card text-white ${bgColor}">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4 class="card-title">${count.toLocaleString()}</h4>
                                    <p class="card-text">${level.charAt(0).toUpperCase() + level.slice(1)}</p>
                                </div>
                                <div class="align-self-center">
                                    <i class="${icon} fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(levelCard);
            });
        }

        async function searchLogs() {
            try {
                const query = document.getElementById('logs-search-query').value || '*';
                const hours = document.getElementById('logs-time-range').value || 24;
                const service = document.getElementById('logs-service-filter').value || '';
                const level = document.getElementById('logs-level-filter').value || '';

                const params = new URLSearchParams();
                params.append('q', query);
                params.append('hours', hours);
                if (service) params.append('service', service);
                if (level) params.append('level', level);

                const response = await fetch(`/api/datadog/logs/search?${params}`);
                const result = await response.json();

                if (result.status === 'success') {
                    displayLogs(result.data);
                } else {
                    console.error('Error searching logs:', result.message);
                    displayLogsError('Failed to search logs: ' + result.message);
                }
            } catch (error) {
                console.error('Error searching logs:', error);
                displayLogsError('Error connecting to logs API');
            }
        }

        function displayLogs(logsData) {
            const container = document.getElementById('logs-list');
            container.innerHTML = '';

            if (!logsData || !logsData.data || logsData.data.length === 0) {
                container.innerHTML = '<div class="alert alert-info">No logs found for the selected criteria.</div>';
                return;
            }

            logsData.data.forEach(log => {
                const logDiv = document.createElement('div');
                logDiv.className = 'card mb-2';
                
                const attributes = log.attributes || {};
                const timestamp = attributes.timestamp ? new Date(attributes.timestamp).toLocaleString() : 'Unknown time';
                const level = attributes.level || 'info';
                const service = attributes.service || 'unknown';
                const message = attributes.message || attributes.msg || 'No message';
                const host = attributes.host || attributes.hostname || 'unknown';

                let levelClass = 'badge bg-info';
                if (level === 'error' || level === 'ERROR') levelClass = 'badge bg-danger';
                else if (level === 'warning' || level === 'WARN') levelClass = 'badge bg-warning';
                else if (level === 'debug' || level === 'DEBUG') levelClass = 'badge bg-secondary';
                else if (level === 'critical' || level === 'CRITICAL') levelClass = 'badge bg-dark';

                // Truncate long messages
                const displayMessage = message.length > 100 ? message.substring(0, 100) + '...' : message;

                logDiv.innerHTML = `
                    <div class="card-body py-2">
                        <div class="row align-items-center">
                            <div class="col-md-1">
                                <span class="${levelClass}">${level.toUpperCase()}</span>
                            </div>
                            <div class="col-md-2">
                                <small class="text-muted"><strong>Service:</strong> ${service}</small>
                            </div>
                            <div class="col-md-2">
                                <small class="text-muted"><strong>Host:</strong> ${host}</small>
                            </div>
                            <div class="col-md-2">
                                <small class="text-muted"><strong>Time:</strong> ${timestamp}</small>
                            </div>
                            <div class="col-md-5">
                                <small><strong>Message:</strong> ${displayMessage}</small>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(logDiv);
            });

            // Add a summary at the top
            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'alert alert-success mb-3';
            summaryDiv.innerHTML = `<i class="fas fa-info-circle"></i> Found ${logsData.data.length} logs from your Datadog account`;
            container.insertBefore(summaryDiv, container.firstChild);
        }

        function displayLogsError(message) {
            const container = document.getElementById('logs-list');
            container.innerHTML = `<div class="alert alert-danger">${message}</div>`;
        }

        function refreshLogsSummary() {
            loadLogsSummary();
        }

        async function loadAllLogs() {
            try {
                const hours = document.getElementById('logs-time-range')?.value || 24;
                const response = await fetch(`/api/datadog/logs/search?q=*&hours=${hours}&limit=50`);
                const result = await response.json();

                if (result.status === 'success') {
                    displayLogs(result.data);
                } else {
                    console.error('Error loading all logs:', result.message);
                    displayLogsError('Failed to load logs: ' + result.message);
                }
            } catch (error) {
                console.error('Error loading all logs:', error);
                displayLogsError('Error connecting to logs API');
            }
        }

        // Load available services for logs
        async function loadAvailableServices() {
            try {
                const response = await fetch('/api/datadog/services');
                const result = await response.json();
                
                if (result.status === 'success') {
                    const serviceSelect = document.getElementById('logs-service-filter');
                    // Clear existing options except "All Services"
                    serviceSelect.innerHTML = '<option value="">All Services</option>';
                    
                    // Add services from Datadog
                    result.data.forEach(service => {
                        const option = document.createElement('option');
                        option.value = service;
                        option.textContent = service;
                        serviceSelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Error loading services:', error);
            }
        }


        // Dashboard Functions
        async function loadAllDashboards() {
            try {
                const response = await fetch('/api/datadog/dashboards');
                const result = await response.json();

                if (result.status === 'success') {
                    displayDashboardsSummary(result.data);
                    displayDashboardsList(result.data);
                } else {
                    console.error('Error loading dashboards:', result.message);
                    displayDashboardsError('Failed to load dashboards: ' + result.message);
                }
            } catch (error) {
                console.error('Error loading dashboards:', error);
                displayDashboardsError('Error connecting to Datadog API');
            }
        }

        async function loadDashboardsSummary() {
            // Legacy function - redirect to loadAllDashboards
            await loadAllDashboards();
        }

        function displayDashboardsSummary(data) {
            const container = document.getElementById('dashboards-summary');
            container.innerHTML = '';

            const dashboards = data.dashboards || [];
            const totalDashboards = dashboards.length;
            const readOnlyDashboards = dashboards.filter(d => d.is_read_only).length;
            const editableDashboards = totalDashboards - readOnlyDashboards;

            const summaryCards = [
                {
                    title: 'Total Dashboards',
                    value: totalDashboards,
                    icon: 'fas fa-tachometer-alt',
                    color: 'primary'
                },
                {
                    title: 'Editable',
                    value: editableDashboards,
                    icon: 'fas fa-edit',
                    color: 'success'
                },
                {
                    title: 'Read Only',
                    value: readOnlyDashboards,
                    icon: 'fas fa-lock',
                    color: 'warning'
                },
                {
                    title: 'Widgets',
                    value: dashboards.reduce((total, d) => total + (d.widgets ? d.widgets.length : 0), 0),
                    icon: 'fas fa-chart-bar',
                    color: 'info'
                }
            ];

            summaryCards.forEach(card => {
                const col = document.createElement('div');
                col.className = 'col-md-3 mb-3';
                col.innerHTML = `
                    <div class="card metric-card h-100">
                        <div class="card-body text-center">
                            <i class="${card.icon} fa-2x text-${card.color} mb-2"></i>
                            <h5 class="card-title">${card.value}</h5>
                            <p class="card-text text-muted">${card.title}</p>
                        </div>
                    </div>
                `;
                container.appendChild(col);
            });
        }

        function displayDashboardsList(data) {
            const container = document.getElementById('dashboards-list');
            container.innerHTML = '';

            const dashboards = data.dashboards || [];

            if (dashboards.length === 0) {
                container.innerHTML = '<div class="alert alert-info">No dashboards found in your Datadog account.</div>';
                return;
            }

            dashboards.forEach(dashboard => {
                const dashboardDiv = document.createElement('div');
                dashboardDiv.className = 'card mb-3';
                
                const readOnlyBadge = dashboard.is_read_only ? 
                    '<span class="badge bg-warning ms-2"><i class="fas fa-lock"></i> Read Only</span>' : 
                    '<span class="badge bg-success ms-2"><i class="fas fa-edit"></i> Editable</span>';
                
                const widgetCount = dashboard.widgets ? dashboard.widgets.length : 0;
                const createdDate = new Date(dashboard.created_at).toLocaleDateString();
                const modifiedDate = new Date(dashboard.modified_at).toLocaleDateString();

                dashboardDiv.innerHTML = `
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-8">
                                <h6 class="card-title">
                                    <a href="${dashboard.url}" target="_blank" class="text-decoration-none">
                                        ${dashboard.title}
                                    </a>
                                    ${readOnlyBadge}
                                </h6>
                                <p class="card-text text-muted">${dashboard.description || 'No description available'}</p>
                                <div class="row">
                                    <div class="col-md-4">
                                        <small class="text-muted"><strong>Author:</strong> ${dashboard.author_name}</small>
                                    </div>
                                    <div class="col-md-4">
                                        <small class="text-muted"><strong>Widgets:</strong> ${widgetCount}</small>
                                    </div>
                                    <div class="col-md-4">
                                        <small class="text-muted"><strong>Modified:</strong> ${modifiedDate}</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 text-end">
                                <button class="btn btn-outline-primary btn-sm mb-2" onclick="loadDashboardDetails('${dashboard.id}')">
                                    <i class="fas fa-info-circle"></i> View Details
                                </button>
                                <br>
                                <a href="${dashboard.url}" target="_blank" class="btn btn-outline-secondary btn-sm">
                                    <i class="fas fa-external-link-alt"></i> Open in Datadog
                                </a>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(dashboardDiv);
            });
        }

        function displayDashboardsError(message) {
            const container = document.getElementById('dashboards-list');
            container.innerHTML = `<div class="alert alert-danger">${message}</div>`;
        }

        async function loadDashboardDetails(dashboardId = null) {
            if (!dashboardId) {
                const input = document.getElementById('dashboard-id-input');
                dashboardId = input.value.trim();
                
                if (!dashboardId) {
                    alert('Please enter a dashboard ID');
                    return;
                }
            }

            try {
                const response = await fetch(`/api/datadog/dashboards/${dashboardId}`);
                const result = await response.json();

                if (result.status === 'success') {
                    displayDashboardDetails(result.data);
                } else {
                    console.error('Error loading dashboard details:', result.message);
                    displayDashboardDetailsError('Failed to load dashboard details: ' + result.message);
                }
            } catch (error) {
                console.error('Error loading dashboard details:', error);
                displayDashboardDetailsError('Error connecting to Datadog API');
            }
        }

        function displayDashboardDetails(dashboard) {
            const container = document.getElementById('dashboard-details');
            container.innerHTML = '';

            const readOnlyBadge = dashboard.is_read_only ? 
                '<span class="badge bg-warning"><i class="fas fa-lock"></i> Read Only</span>' : 
                '<span class="badge bg-success"><i class="fas fa-edit"></i> Editable</span>';

            const createdDate = new Date(dashboard.created_at).toLocaleString();
            const modifiedDate = new Date(dashboard.modified_at).toLocaleString();

            let widgetsHtml = '';
            if (dashboard.widgets && dashboard.widgets.length > 0) {
                widgetsHtml = '<h6 class="mt-3">Widgets:</h6><ul class="list-group">';
                dashboard.widgets.forEach(widget => {
                    const widgetDef = widget.definition || {};
                    widgetsHtml += `
                        <li class="list-group-item">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <strong>${widgetDef.title || 'Untitled Widget'}</strong>
                                    <br>
                                    <small class="text-muted">Type: ${widgetDef.type || 'Unknown'}</small>
                                </div>
                                <span class="badge bg-secondary">ID: ${widget.id}</span>
                            </div>
                        </li>
                    `;
                });
                widgetsHtml += '</ul>';
            } else {
                widgetsHtml = '<div class="alert alert-info">No widgets found in this dashboard.</div>';
            }

            container.innerHTML = `
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            ${dashboard.title}
                            ${readOnlyBadge}
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Description:</strong> ${dashboard.description || 'No description available'}</p>
                                <p><strong>Author:</strong> ${dashboard.author_name}</p>
                                <p><strong>Created:</strong> ${createdDate}</p>
                                <p><strong>Modified:</strong> ${modifiedDate}</p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Dashboard ID:</strong> <code>${dashboard.id}</code></p>
                                <p><strong>URL:</strong> <a href="${dashboard.url}" target="_blank">${dashboard.url}</a></p>
                                <p><strong>Widget Count:</strong> ${dashboard.widgets ? dashboard.widgets.length : 0}</p>
                            </div>
                        </div>
                        ${widgetsHtml}
                    </div>
                </div>
            `;
        }

        function displayDashboardDetailsError(message) {
            const container = document.getElementById('dashboard-details');
            container.innerHTML = `<div class="alert alert-danger">${message}</div>`;
        }

        async function loadSpecificDashboard() {
            const dashboardId = document.getElementById('dashboard-id-input').value.trim();
            if (!dashboardId) {
                alert('Please enter a dashboard ID');
                return;
            }
            await loadDashboardDetails(dashboardId);
        }

        // Add event listeners for logs and dashboards tabs
        document.addEventListener('DOMContentLoaded', function() {
            const datadogLogsTab = document.getElementById('datadog-logs-tab');
            if (datadogLogsTab) {
                datadogLogsTab.addEventListener('click', function() {
                    loadLogsSummary();
                    loadAvailableServices();
                });
            }

            const datadogDashboardsTab = document.getElementById('datadog-dashboards-tab');
            if (datadogDashboardsTab) {
                datadogDashboardsTab.addEventListener('click', function() {
                    loadAllDashboards();
                });
            }
        });
    </script>
</body>
</html>

</html>
